var CanvasSpace,Circle,Color,Const,Curve,Form,Grid,Line,Matrix,Pair,Particle,ParticleSystem,Point,PointSet,Rectangle,Space,Timer,Triangle,Util,Vector,extend=function(t,n){function i(){this.constructor=t}for(var e in n)hasProp.call(n,e)&&(t[e]=n[e]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},hasProp={}.hasOwnProperty;Const=function(){function t(){}return t.xy="xy",t.yz="yz",t.xz="xz",t.xyz="xyz",t.identical=0,t.right=1,t.bottom_right=2,t.bottom=3,t.bottom_left=4,t.left=5,t.top_left=6,t.top=7,t.top_right=8,t.sideLabels=["identical","right","bottom right","bottom","bottom left","left","top left","top","top right"],t.epsilon=1e-4,t.two_pi=6.283185307179586,t.half_pi=1.5707963267948966,t.quarter_pi=.7853981633974483,t.one_degree=.017453292519943295,t.rad_to_deg=57.29577951308232,t.deg_to_rad=.017453292519943295,t.gravity=9.81,t.newton=.10197,t}(),this.Const=Const,Matrix=function(){function t(){}return t.rotateAnchor2D=function(t,n,i){var e,s,r;return null==i&&(i=Const.xy),e=n.get2D(i),s=Math.cos(t),r=Math.sin(t),[s,r,0,-r,s,0,e.x*(1-s)+e.y*r,e.y*(1-s)-e.x*r,1]},t.reflectAnchor2D=function(t,n){var i,e,s,r;return null==n&&(n=Const.xy),s=t.intercept(n),i=2*Math.atan(s.slope),e=Math.cos(i),r=Math.sin(i),[e,r,0,r,-e,0,-s.yi*r,s.yi+s.yi*e,1]},t.shearAnchor2D=function(t,n,i,e){var s,r,o;return null==e&&(e=Const.xy),s=i.get2D(e),r=Math.tan(t),o=Math.tan(n),[1,r,0,o,1,0,-s.y*o,-s.x*r,1]},t.scaleAnchor2D=function(t,n,i,e){var s;return null==e&&(e=Const.xy),s=i.get2D(e),[t,0,0,0,n,0,-s.x*t+s.x,-s.y*n+s.y,1]},t.scale2D=function(t,n){return[t,0,0,0,n,0,0,0,1]},t.shear2D=function(t,n){return[1,Math.tan(t),0,Math.tan(n),1,0,0,0,1]},t.rotate2D=function(t,n){return[t,n,0,-n,t,0,0,0,1]},t.translate2D=function(t,n){return[1,0,0,0,1,0,t,n,1]},t.transform2D=function(t,n,i,e){var s,r,o;return null==i&&(i=Const.xy),null==e&&(e=!1),s=t.get2D(i),r=s.x*n[0]+s.y*n[3]+n[6],o=s.x*n[1]+s.y*n[4]+n[7],s.x=r,s.y=o,s=s.get2D(i,!0),e?s:(t.set(s),t)},t}(),this.Matrix=Matrix,Util=function(){function t(){}return t.toRadian=function(t){return t*Const.deg_to_rad},t.toDegree=function(t){return t*Const.rad_to_deg},t.toHexColor=function(t){var n;return n=Math.floor(t).toString(16),1===n.length?"0"+n:n},t.toRGBColor=function(t,n,i){var e,s,r;return null==n&&(n=!1),null==i&&(i=1),"#"===t[0]&&(t=t.substr(1)),3===t.length?(r=parseInt(t[0]+t[0],16),s=parseInt(t[1]+t[1],16),e=parseInt(t[2]+t[2],16)):t.length>=6?(r=parseInt(t[0]+t[1],16),s=parseInt(t[2]+t[3],16),e=parseInt(t[4]+t[5],16)):(r=0,s=0,e=0),n?"rgba("+r+","+s+","+e+","+i+")":[r,s,e,i]},t.bound=function(t,n,i){var e,s;return null==i&&(i=!1),e=t%n,s=n/2,e>s?e-=n:-s>e&&(e+=n),i&&0>e?e+n:e},t.boundAngle=function(n,i){return t.bound(n,360,i)},t.boundRadian=function(n,i){return t.bound(n,Const.two_pi,i)},t.boundingBox=function(t,n){var i,e,s,r,o;for(null==n&&(n=!1),r=new Point(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new Point(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),i=0,e=t.length;e>i;i++)o=t[i],o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),o.x>s.x&&(s.x=o.x),o.y>s.y&&(s.y=o.y),n&&(o.z<r.z&&(r.z=o.z),o.z>s.z&&(s.z=o.z));return new Rectangle(r).connect(s)},t.lerp=function(t,n,i){return(1-i)*t+i*n},t.centroid=function(t){var n,i,e,s;for(n=new Vector,i=0,e=t.length;e>i;i++)s=t[i],n.add(s);return n.divide(t.length)},t.same=function(t,n,i){return null==i&&(i=Const.epsilon),Math.abs(t-n)<i},t.within=function(t,n,i){return t>=Math.min(n,i)&&t<=Math.max(n,i)},t.randomRange=function(t,n){var i;return null==n&&(n=0),i=t>n?t-n:n-t,n+Math.random()*i},t.mixin=function(t,n){var i,e;for(i in n)e=n[i],n.hasOwnProperty(i)&&(t.prototype[i]=n[i]);return t},t.extend=function(t,n){return t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t},t.clonePoints=function(t){var n,i,e,s;for(s=[],n=0,i=t.length;i>n;n++)e=t[n],s.push(e.clone());return s},t.contextRotateOrigin=function(t,n,i,e,s){var r,o;return null==e&&(e=!1),o=n.size(),e||(e=o.$multiply(.5),e.add(n)),s&&(r=s.size(),Form.rect(t,s),t.clip()),t.translate(e.x,e.y),t.rotate(i),t.translate(-e.x,-e.y)},t.sinCosTable=function(){var t,n,i,e;for(t=[],e=[],n=i=0;360>=i;n=i+=1)t[n]=Math.cos(n*Math.PI/180),e[n]=Math.sin(n*Math.PI/180);return{sin:e,cos:t}},t.chance=function(t){return Math.random()<t},t}(),this.Util=Util,this.Util=Util,Timer=function(){function t(t){null==t&&(t=1e3),this.duration=t,this._time=0,this._ease=function(t,n,i,e){return t/e},this._intervalID=-1}return t.prototype.start=function(t){var n;return n=Math.min(Date.now()-this._time,this.duration),t||n>=this.duration?this._time=Date.now():void 0},t.prototype.setEasing=function(t){return this._ease=t},t.prototype.check=function(){var t;return t=Math.min(Date.now()-this._time,this.duration),this._ease(t,0,1,this.duration)},t.prototype.track=function(t){var n;return clearInterval(this._intervalID),this.start(!0),n=this,this._intervalID=setInterval(function(){var i;return i=n.check(),t(i),i>=1?clearInterval(n._intervalID):void 0},25),this._intervalID},t}(),this.Timer=Timer,Space=function(){function t(t){null==t&&(t="space"),this.id=t,this.renderer=function(t){return function(t){}}(this),this.size=new Vector,this.center=new Vector,this._timePrev=0,this._timeDiff=0,this._timeEnd=-1,this.items={},this._animID=-1,this._animCount=0,this._animPause=!1,this._refresh=!0}return t.prototype.refresh=function(t){return this._refresh=t},t.prototype.render=function(t){return this.renderer=t,this},t.prototype.resize=function(t,n){},t.prototype.clear=function(){},t.prototype.add=function(t){var n;if(null==t.animate||"function"!=typeof t.animate)throw"a player object for Space.add must define animate()";return n=this._animCount++,this.items[n]=t,t.animateID=n,null!=t.onSpaceResize&&t.onSpaceResize(this.size.x,this.size.y),this},t.prototype.remove=function(t){return delete this.items[t.animateID],this},t.prototype.removeAll=function(){return this.items={},this},t.prototype.play=function(t){var n;if(null==t&&(t=0),this._animID=requestAnimationFrame(function(t){return function(n){return t.play(n)}}(this)),!this._animPause){this._timeDiff=t-this._timePrev;try{this._playItems(t)}catch(i){throw n=i,cancelAnimationFrame(this._animID),console.error(n.stack),n}return this._timePrev=t,this}},t.prototype._playItems=function(t){var n,i,e;this._refresh&&this.clear(),i=this.items;for(n in i)e=i[n],e.animate(t,this._timeDiff,this.ctx);return this._timeEnd>=0&&t>this._timeEnd&&cancelAnimationFrame(this._animID),this},t.prototype.pause=function(t){return null==t&&(t=!1),this._animPause=t?!this._animPause:!0,this},t.prototype.resume=function(){return this._animPause=!1,this},t.prototype.stop=function(t){return null==t&&(t=0),this._timeEnd=t,this},t.prototype.playTime=function(t){return null==t&&(t=5e3),this.play(),this.stop(t)},t}(),this.Space=Space,CanvasSpace=function(t){function n(t,i,e){null==t&&(t="pt_space"),null==i&&(i=!1),null==e&&(e="2d"),n.__super__.constructor.apply(this,arguments),this.canvas=document.querySelector("#"+this.id),this.appended=!0,this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",this.id),this.appended=!1),this._mdown=!1,this._mdrag=!1,this.bgcolor=i,this.ctx=this.canvas.getContext(e)}return extend(n,t),n.prototype.display=function(t,n){var i,e;if(null==t&&(t="#pt"),!this.appended){if(i=document.querySelector(t),e=i.getBoundingClientRect(),!i)throw"Cannot add canvas to element "+t;this.resize(e.width,e.height),window.addEventListener("resize",function(t){return e=i.getBoundingClientRect(),this.resize(e.width,e.height,t)}.bind(this)),this.canvas.parentNode!==i&&i.appendChild(this.canvas),this.appended=!0,setTimeout(function(){return this.canvas.dispatchEvent(new Event("ready")),n?n(e.width,e.height,this.canvas):void 0}.bind(this))}return this},n.prototype.resize=function(t,n,i){var e,s,r;this.size.set(t,n),this.center=new Vector(t/2,n/2),this.canvas.setAttribute("width",Math.floor(t)),this.canvas.setAttribute("height",Math.floor(n)),r=this.items;for(e in r)s=r[e],null!=s.onSpaceResize&&s.onSpaceResize(t,n,i);return this.renderer(this.ctx),this},n.prototype.clear=function(t){var n;return t&&(this.bgcolor=t),n=this.ctx.fillStyle,this.bgcolor?(this.ctx.fillStyle=this.bgcolor,this.ctx.fillRect(0,0,this.size.x,this.size.y)):this.ctx.clearRect(0,0,this.size.x,this.size.y),this.ctx.fillStyle=n,this},n.prototype.animate=function(t){var n,i,e;this.ctx.save(),this._refresh&&this.clear(),i=this.items;for(n in i)e=i[n],e.animate(t,this._timeDiff,this.ctx);return this._timeEnd>=0&&t>this._timeEnd&&cancelAnimationFrame(this._animID),this.ctx.restore(),this},n.prototype.bind=function(t,n){return this.canvas.addEventListener(t,n)},n.prototype.bindMouse=function(t){return null==t&&(t=!0),t?(this.canvas.addEventListener("mousedown",this._mouseDown.bind(this)),this.canvas.addEventListener("mouseup",this._mouseUp.bind(this)),this.canvas.addEventListener("mouseover",this._mouseOver.bind(this)),this.canvas.addEventListener("mouseout",this._mouseOut.bind(this)),this.canvas.addEventListener("mousemove",this._mouseMove.bind(this))):(this.canvas.removeEventListener("mousedown",this._mouseDown.bind(this)),this.canvas.removeEventListener("mouseup",this._mouseUp.bind(this)),this.canvas.removeEventListener("mouseover",this._mouseOver.bind(this)),this.canvas.removeEventListener("mouseout",this._mouseOut.bind(this)),this.canvas.removeEventListener("mousemove",this._mouseMove.bind(this)))},n.prototype._mouseAction=function(t,n){var i,e,s,r;e=this.items,s=[];for(i in e)r=e[i],s.push(null!=r.onMouseAction?r.onMouseAction(t,n.offsetX,n.offsetY,n):void 0);return s},n.prototype._mouseDown=function(t){return this._mouseAction("down",t),this._mdown=!0},n.prototype._mouseUp=function(t){return this._mouseAction("up",t),this._mdrag&&this._mouseAction("drop",t),this._mdown=!1,this._mdrag=!1},n.prototype._mouseMove=function(t){return this._mouseAction("move",t),this._mdown?(this._mdrag=!0,this._mouseAction("drag",t)):void 0},n.prototype._mouseOver=function(t){return this._mouseAction("over",t)},n.prototype._mouseOut=function(t){return this._mouseAction("out",t),this._mdrag&&this._mouseAction("drop",t),this._mdrag=!1},n}(Space),this.CanvasSpace=CanvasSpace,Form=function(){function t(t){this.cc=t,this.cc.fillStyle="#999",this.cc.strokeStyle="#666",this.cc.lineWidth=1,this.cc.font="11px sans-serif",this.filled=!0,this.stroked=!0,this.fontSize=11,this.fontFace="sans-serif"}return t.context=function(t){var n,i;if(i=document.getElementById(t),n=i&&i.getContext?i.getContext("2d"):!1,!n)throw"Cannot initiate canvas 2d context";return n},t.line=function(t,n){if(!n.p1)throw n.toString()+" is not a Pair";return t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.p1.x,n.p1.y),t.stroke()},t.lines=function(n,i){var e,s,r,o;for(o=[],e=0,s=i.length;s>e;e++)r=i[e],o.push(t.line(n,r));return o},t.rect=function(t,n,i,e){if(null==i&&(i=!0),null==e&&(e=!1),!n.p1)throw""+(n.toString()===!a(Pair));return t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.x,n.p1.y),t.lineTo(n.p1.x,n.p1.y),t.lineTo(n.p1.x,n.y),t.closePath(),e&&t.stroke(),i?t.fill():void 0},t.circle=function(t,n,i,e){null==i&&(i=!0),null==e&&(e=!1),t.beginPath(),t.arc(n.x,n.y,n.radius,0,Const.two_pi,!1),i&&t.fill(),e&&t.stroke()},t.triangle=function(t,n,i,e){null==i&&(i=!0),null==e&&(e=!1),t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.p1.x,n.p1.y),t.lineTo(n.p2.x,n.p2.y),t.closePath(),i&&t.fill(),e&&t.stroke()},t.point=function(t,n,i,e,s,r){var o,h,u,a;return null==i&&(i=2),null==e&&(e=!0),null==s&&(s=!1),null==r&&(r=!1),r?(t.beginPath(),t.arc(n.x,n.y,i,0,Const.two_pi,!1)):(o=n.x-i,u=n.y-i,h=n.x+i,a=n.y+i,t.beginPath(),t.moveTo(o,u),t.lineTo(o,a),t.lineTo(h,a),t.lineTo(h,u),t.closePath()),e&&t.fill(),s&&t.stroke(),n},t.points=function(n,i,e,s,r,o){var h,u,a,c;for(null==e&&(e=2),null==s&&(s=!0),null==r&&(r=!1),null==o&&(o=!1),c=[],h=0,u=i.length;u>h;h++)a=i[h],c.push(t.point(n,a,e,s,r,o));return c},t.polygon=function(t,n,i,e,s){var r,o,h;if(null==i&&(i=!0),null==e&&(e=!0),null==s&&(s=!0),!(n.length<=1)){for(t.beginPath(),t.moveTo(n[0].x,n[0].y),r=o=1,h=n.length;h>o;r=o+=1)t.lineTo(n[r].x,n[r].y);i&&t.closePath(),e&&t.fill(),s&&t.stroke()}},t.curve=function(n,i){return t.polygon(n,i,!1,!1,!0)},t.text=function(t,n,i,e){return t.fillText(i,n.x,n.y,e)},t.prototype.fill=function(t){return this.cc.fillStyle=t?t:"transparent",this.filled=!!t,this},t.prototype.stroke=function(t,n,i){return this.cc.strokeStyle=t?t:"transparent",this.stroked=!!t,n&&(this.cc.lineWidth=n),i&&(this.cc.lineJoin=i),this},t.prototype.font=function(t,n){return null==n&&(n=this.fontFace),this.fontSize=t,this.cc.font=t+"px "+n,this},t.prototype.draw=function(t){return this.sketch(t)},t.prototype.sketch=function(n){return n.floor(),n instanceof Circle?t.circle(this.cc,n,this.filled,this.stroked):n instanceof Rectangle?t.rect(this.cc,n,this.filled,this.stroked):n instanceof Triangle?t.triangle(this.cc,n,this.filled,this.stroked):n instanceof Line||n instanceof Pair?t.line(this.cc,n):n instanceof PointSet?t.polygon(this.cc,n.points):(n instanceof Vector||n instanceof Point)&&t.point(this.cc,n),this},t.prototype.point=function(n,i,e){return null==i&&(i=2),null==e&&(e=!1),t.point(this.cc,n,i,this.filled,this.stroked,e),this},t.prototype.points=function(n,i,e){return null==i&&(i=2),null==e&&(e=!1),t.points(this.cc,n,i,this.filled,this.stroked,e),this},t.prototype.line=function(n){return t.line(this.cc,n),this},t.prototype.lines=function(n){return t.lines(this.cc,n),this},t.prototype.rect=function(n){return t.rect(this.cc,n,this.filled,this.stroked),this},t.prototype.circle=function(n){return t.circle(this.cc,n,this.filled,this.stroked),this},t.prototype.triangle=function(n){return t.triangle(this.cc,n,this.filled,this.stroked),this},t.prototype.polygon=function(n,i){return t.polygon(this.cc,n,i,this.filled,this.stroked),this},t.prototype.curve=function(n){return t.curve(this.cc,n),this},t.prototype.text=function(t,n,i,e,s){var r;return null==i&&(i=1e3),r=new Vector(t),e&&r.add(e,0),s&&r.add(0,s),this.cc.fillText(n,r.x,r.y,i),this},t}(),this.Form=Form,Point=function(){function t(n){this.copy(t.get(arguments))}return t.get=function(t){return t.length>0?"object"==typeof t[0]?t[0]instanceof Array||t[0].length>0?{x:t[0][0]||0,y:t[0][1]||0,z:t[0][2]||0}:{x:t[0].x||0,y:t[0].y||0,z:t[0].z||0}:{x:t[0]||0,y:t[1]||0,z:t[2]||0}:{x:0,y:0,z:0}},t.prototype.quadrant=function(t,n){return null==n&&(n=Const.epsilon),t.near(this)?Const.identical:Math.abs(t.x-this.x)<n?t.y<this.y?Const.top:Const.bottom:Math.abs(t.y-this.y)<n?t.x<this.x?Const.left:Const.right:t.y<this.y&&t.x>this.x?Const.top_right:t.y<this.y&&t.x<this.x?Const.top_left:t.y>this.y&&t.x<this.x?Const.bottom_left:Const.bottom_right},t.prototype.set=function(n){var i;return i=t.get(arguments),this.x=i.x,this.y=i.y,this.z=i.z,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.clone=function(){return new t(this)},t.prototype.toString=function(){return"Point "+this.x+", "+this.y+", "+this.z},t.prototype.get2D=function(t,n){return null==n&&(n=!1),t===Const.xy?new this.__proto__.constructor(this):t===Const.xz?new this.__proto__.constructor(this.x,this.z,this.y):t===Const.yz?n?new this.__proto__.constructor(this.z,this.x,this.y):new this.__proto__.constructor(this.y,this.z,this.x):new this.__proto__.constructor(this)},t.prototype.min=function(n){var i;return i=t.get(arguments),new t(Math.min(this.x,i.x),Math.min(this.y,i.y),Math.min(this.z,i.z))},t.prototype.max=function(n){var i;return i=t.get(arguments),new t(Math.max(this.x,i.x),Math.max(this.y,i.y),Math.max(this.z,i.z))},t.prototype.equal=function(n){var i;return i=t.get(arguments),i.x===this.x&&i.y===this.y&&i.z===this.z},t.prototype.near=function(n,i){var e;return null==i&&(i=Const.epsilon),e=t.get(arguments),Math.abs(e.x-this.x)<i&&Math.abs(e.y-this.y)<i&&Math.abs(e.z-this.z)<i},t.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},t}(),this.Point=Point,Vector=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return extend(n,t),n.prototype._getArgs=function(t){return"number"==typeof t[0]&&t.length>1?t:t[0]},n.prototype.add=function(t){var n;return"number"==typeof arguments[0]&&1===arguments.length?(this.x+=arguments[0],this.y+=arguments[0],this.z+=arguments[0]):(n=Point.get(arguments),this.x+=n.x,this.y+=n.y,this.z+=n.z),this},n.prototype.$add=function(t){var i;return i=this._getArgs(arguments),new n(this).add(i)},n.prototype.subtract=function(t){var n;return"number"==typeof arguments[0]&&1===arguments.length?(this.x-=arguments[0],this.y-=arguments[0],this.z-=arguments[0]):(n=Point.get(arguments),this.x-=n.x,this.y-=n.y,this.z-=n.z),this},n.prototype.$subtract=function(t){var i;return i=this._getArgs(arguments),new n(this).subtract(i)},n.prototype.multiply=function(t){var n;return"number"==typeof arguments[0]&&1===arguments.length?(this.x*=arguments[0],this.y*=arguments[0],this.z*=arguments[0]):(n=Point.get(arguments),this.x*=n.x,this.y*=n.y,this.z*=n.z),this},n.prototype.$multiply=function(t){var i,e;return i=e=this._getArgs(arguments),new n(this).multiply(i)},n.prototype.divide=function(t){var n;return"number"==typeof arguments[0]&&1===arguments.length?(this.x/=arguments[0],this.y/=arguments[0],this.z/=arguments[0]):(n=Point.get(arguments),this.x/=n.x,this.y/=n.y,this.z/=n.z),this},n.prototype.$divide=function(t){var i;return i=this._getArgs(arguments),new n(this).divide(i)},n.prototype.angle=function(t){var n,i;return 0===arguments.length?Math.atan2(this.y,this.x):("string"==typeof arguments[0]?(n=arguments[0],i=arguments.length>1?this.$subtract(arguments[1]).multiply(-1):void 0):(i=this.$subtract(arguments[0]).multiply(-1),n=!1),i&&!n?Math.atan2(i.y,i.x):n===Const.xy?i?Math.atan2(i.y,i.x):Math.atan2(this.y,this.x):n===Const.yz?i?Math.atan2(i.z,i.y):Math.atan2(this.z,this.y):n===Const.xz?i?Math.atan2(i.z,i.x):Math.atan2(this.z,this.x):void 0)},n.prototype.angleBetween=function(t,n){return null==n&&(n=Const.xy),Util.boundRadian(this.angle(n),!0)-Util.boundRadian(t.angle(n),!0)},n.prototype.magnitude=function(t){var n,i,e,s,r,o;return e={x:this.x*this.x,y:this.y*this.y,z:this.z*this.z},o=arguments.length>=1&&!arguments[arguments.length-1],n=o?function(t){return t}:Math.sqrt,0===arguments.length?n(e.x+e.y+e.z):("string"==typeof arguments[0]?(i=arguments[0],r=arguments.length>1&&arguments[1]?this.$subtract(arguments[1]):void 0):(r=this.$subtract(arguments[0]),i=!1),s=r?{x:r.x*r.x,y:r.y*r.y,z:r.z*r.z}:e,r&&!i?n(s.x+s.y+s.z):i===Const.xy?n(s.x+s.y):i===Const.yz?n(s.y+s.z):i===Const.xz?n(s.x+s.z):void 0)},n.prototype.distance=function(t,n){return null==n&&(n=Const.xy),this.magnitude(n,t)},n.prototype.normalize=function(){return this.set(this.$normalize()),this},n.prototype.$normalize=function(){var t;return t=this.magnitude(),0===t?new n:new n(this.x/t,this.y/t,this.z/t)},n.prototype.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},n.prototype.dot=function(t,n){return null==n&&(n=Const.xyz),n===Const.xyz?this.x*t.x+this.y*t.y+this.z*t.z:n===Const.xy?this.x*t.x+this.y*t.y:n===Const.yz?this.y*t.y+this.z*t.z:n===Const.xz?this.x*t.x+this.z*t.z:this.x*t.x+this.y*t.y+this.z*t.z},n.prototype.projection=function(t,i){var e,s,r,o;return null==i&&(i=Const.xyz),o=t.magnitude(),e=this.$normalize(),s=new n(t.x/o,t.y/o,t.z/o),r=e.dot(s,i),e.$multiply(o*r)},n.prototype.cross=function(t){return new n(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},n.prototype.bisect=function(t,n){return null==n&&(n=!1),n?this.$add(t).divide(2):this.$normalize().add(t.$normalize()).divide(2)},n.prototype.perpendicular=function(t){switch(null==t&&(t=Const.xy),t){case Const.xy:return[new n(-this.y,this.x,this.z),new n(this.y,-this.x,this.z)];case Const.yz:return[new n(this.x,-this.z,this.y),new n(this.x,this.z,-this.y)];case Const.xz:return[new n(-this.z,this.y,this.x),new n(this.z,-this.y,this.x)];default:return[new n(-this.y,this.x,this.z),new n(this.y,-this.x,this.z)]}},n.prototype.isPerpendicular=function(t,n){return null==n&&(n=Const.xyz),0===this.dot(t,n)},n.prototype.surfaceNormal=function(t){return this.cross(t).normalize(!0)},n.prototype.moveTo=function(t){var n,i,e,s,r,o;for(o=Point.get(arguments),n=this.$subtract(o),r=this.toArray(),i=0,e=r.length;e>i;i++)s=r[i],s.subtract(n);return this},n.prototype.moveBy=function(t){var n,i,e,s,r;for(n=Point.get(arguments),r=this.toArray(),i=0,e=r.length;e>i;i++)s=r[i],s.add(n);return this},n.prototype.rotate2D=function(t,n,i){var e,s,r,o,h;for(null==i&&(i=Const.xy),n||(n=new Point(0,0,0)),r=Matrix.rotateAnchor2D(t,n,i),h=this.toArray(),e=0,s=h.length;s>e;e++)o=h[e],Matrix.transform2D(o,r,i);return this},n.prototype.reflect2D=function(t,n){var i,e,s,r,o;for(null==n&&(n=Const.xy),s=Matrix.reflectAnchor2D(t,n),o=this.toArray(),i=0,e=o.length;e>i;i++)r=o[i],Matrix.transform2D(r,s,n);return this},n.prototype.scale2D=function(t,n,i,e){var s,r,o,h,u;for(null==e&&(e=Const.xy),i||(i=new Point(0,0,0)),o=Matrix.scaleAnchor2D(t,n,i,e),u=this.toArray(),s=0,r=u.length;r>s;s++)h=u[s],Matrix.transform2D(h,o,e);return this},n.prototype.shear2D=function(t,n,i,e){var s,r,o,h,u;for(null==e&&(e=Const.xy),i||(i=new Point(0,0,0)),o=Matrix.shearAnchor2D(t,n,i,e),u=this.toArray(),s=0,r=u.length;r>s;s++)h=u[s],Matrix.transform2D(h,o,e);return this},n.prototype.clone=function(){return new n(this)},n.prototype.toString=function(){return"Vector "+this.x+", "+this.y+", "+this.z},n.prototype.toArray=function(){return[this]},n}(Point),this.Vector=Vector,Color=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.alpha=arguments.length>=4?Math.min(1,Math.max(arguments[3],0)):1,this.mode=arguments.length>=5?arguments[4]:"rgb"}return extend(n,t),n.XYZ={D65:{x:95.047,y:100,z:108.883}},n.parseHex=function(t,i){var e,s;return null==i&&(i=!1),0===t.indexOf("#")&&(t=t.substr(1)),3===t.length&&(t=""+t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),8===t.length&&(this.alpha=1&t.substr(6),t=t.substring(0,6)),e=parseInt(t,16),s=[e>>16,e>>8&255,255&e],i?new n(s[0],s[1],s[2]):s},n.prototype.setMode=function(t){if(t=t.toLowerCase(),t!==this.mode){switch(this.mode){case"hsl":this.copy(Point.get(n.HSLtoRGB(this.x,this.y,this.z)));break;case"hsb":this.copy(Point.get(n.HSBtoRGB(this.x,this.y,this.z)));break;case"lab":this.copy(Point.get(n.LABtoRGB(this.x,this.y,this.z)));break;case"lch":this.copy(Point.get(n.LCHtoRGB(this.x,this.y,this.z)));break;case"xyz":this.copy(Point.get(n.XYZtoRGB(this.x,this.y,this.z)))}switch(t){case"hsl":this.copy(Point.get(n.RGBtoHSL(this.x,this.y,this.z)));break;case"hsb":this.copy(Point.get(n.RGBtoHSB(this.x,this.y,this.z)));break;case"lab":this.copy(Point.get(n.RGBtoLAB(this.x,this.y,this.z)));break;case"lch":this.copy(Point.get(n.RGBtoLCH(this.x,this.y,this.z)));break;case"xyz":this.copy(Point.get(n.RGBtoXYZ(this.x,this.y,this.z)))}}return this.mode=t,this},n.prototype.hex=function(){var t,n,i,e;return"rgb"===this.mode&&this.floor(),n=this.values("rgb"!==this.mode),t=function(t){return t=t.toString(16),t.length<2?"0"+t:t},i=function(){var i,s,r;for(r=[],i=0,s=n.length;s>i;i++)e=n[i],r.push(t(e));return r}(),"#"+i[0]+i[1]+i[2]},n.prototype.rgb=function(){var t;return"rgb"===this.mode&&this.floor(),t=this.values("rgb"!==this.mode),"rgb("+t[0]+", "+t[1]+", "+t[2]+")"},n.prototype.rgba=function(){var t;return"rgb"===this.mode&&this.floor(),t=this.values("rgb"!==this.mode),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+this.alpha+")"},n.prototype.values=function(t){var i,e;if(null==t&&(t=!1),i=[this.x,this.y,this.z],t&&"rgb"!==this.mode)switch(this.mode){case"hsl":i=n.HSLtoRGB(this.x,this.y,this.z);break;case"hsb":i=n.HSBtoRGB(this.x,this.y,this.z);break;case"lab":i=n.LABtoRGB(this.x,this.y,this.z);break;case"lch":i=n.LCHtoRGB(this.x,this.y,this.z);break;case"xyz":i=n.XYZtoRGB(this.x,this.y,this.z)}return function(){var t,n,s;for(s=[],t=0,n=i.length;n>t;t++)e=i[t],s.push(Math.floor(e));return s}()},n.RGBtoHSL=function(t,n,i,e,s){var r,o,h,u,a,c;if(e||(t/=255,n/=255,i/=255),u=Math.max(t,n,i),a=Math.min(t,n,i),o=(u+a)/2,c=o,h=o,u===a)o=0,c=0;else switch(r=u-a,c=h>.5?r/(2-u-a):r/(u+a),u){case t:o=(n-i)/r+(i>n?6:0);break;case n:o=(i-t)/r+2;break;case i:o=(t-n)/r+4;break;default:o=0}return s?[o/60,c,h]:[60*o,c,h]},n.HSLtoRGB=function(t,n,i,e,s){var r,o,h,u,a,c;return 0===n?s?[1,1,1]:[255,255,255]:(e||(t/=360),a=.5>=i?i*(1+n):i+n-i*n,u=2*i-a,h=function(t,n,i){return 0>i?i+=1:i>1&&(i-=1),1>6*i?t+(n-t)*i*6:1>2*i?n:2>3*i?t+(n-t)*(2/3-i)*6:t},c=h(u,a,t+1/3),o=h(u,a,t),r=h(u,a,t-1/3),s?[c,o,r]:[255*c,255*o,255*r])},n.RGBtoHSB=function(t,n,i,e,s){var r,o,h,u,a,c;if(e||(t/=255,n/=255,i/=255),h=Math.max(t,n,i),u=Math.min(t,n,i),r=h-u,a=0===h?0:r/h,c=h,h===u)o=0;else switch(h){case t:o=(n-i)/r+(i>n?6:0);break;case n:o=(i-t)/r+2;break;case i:o=(t-n)/r+4;break;default:o=0}return s?[o/60,a,c]:[60*o,a,c]},n.HSBtoRGB=function(t,n,i,e,s){var r,o,h,u,a,c;switch(e||(t/=360),o=Math.floor(6*t),r=6*t-o,h=i*(1-n),u=i*(1-r*n),c=i*(1-(1-r)*n),o%6){case 0:a=[i,c,h];break;case 1:a=[u,i,h];break;case 2:a=[h,i,c];break;case 3:a=[h,u,i];break;case 4:a=[c,h,i];break;case 5:a=[i,h,u];break;default:a=[0,0,0]}return s?a:[255*a[0],255*a[1],255*a[2]]},n.RGBtoLAB=function(t,i,e,s,r){var o;return s&&(t*=255,i*=255,e*=255),o=n.RGBtoXYZ(t,i,e),n.XYZtoLAB(o[0],o[1],o[2])},n.LABtoRGB=function(t,i,e,s,r){var o,h;return s&&(t*=100,i=127*(i-.5),e=127*(e-.5)),h=n.LABtoXYZ(t,i,e),o=n.XYZtoRGB(h[0],h[1],h[2]),r?[o[0]/255,o[1]/255,o[2]/255]:o},n.RGBtoLCH=function(t,i,e,s,r){var o,h;return s&&(t*=255,i*=255,e*=255),o=n.RGBtoLAB(t,i,e),h=n.LABtoLCH(o[0],o[1],o[2]),r?[h[0]/100,h[1]/100,h[2]/360]:h},n.LCHtoRGB=function(t,i,e,s,r){var o,h,u;return s&&(t*=100,i*=100,e*=360),o=n.LCHtoLAB(t,i,e),u=n.LABtoXYZ(o[0],o[1],o[2]),h=n.XYZtoRGB(u[0],u[1],u[2]),r?[h[0]/255,h[1]/255,h[2]/255]:h},n.XYZtoRGB=function(t,n,i,e,s){var r,o,h,u,a;for(e||(t/=100,n/=100,i/=100),a=[3.2404542*t+-1.5371385*n+i*-.4985314,t*-.969266+1.8760108*n+.041556*i,.0556434*t+n*-.2040259+1.0572252*i],o=h=0,u=a.length;u>h;o=++h)r=a[o],a[o]=0>r?0:Math.min(1,r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r);return s?a:[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]},n.RGBtoXYZ=function(t,n,i,e,s){return e||(t/=255,n/=255,i/=255),t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,s||(t=100*t,n=100*n,i=100*i),[.4124564*t+.3575761*n+.1804375*i,.2126729*t+.7151522*n+.072175*i,.0193339*t+.119192*n+.9503041*i]},n.XYZtoLAB=function(t,i,e){var s,r;return t/=n.XYZ.D65.x,i/=n.XYZ.D65.y,e/=n.XYZ.D65.z,s=function(t){return t>.008856?Math.pow(t,1/3):7.787*t+16/116},r=s(i),[116*r-16,500*(s(t)-r),200*(r-s(e))]},n.LABtoXYZ=function(t,i,e){var s,r,o,h,u;return h=(t+16)/116,r=i/500+h,u=h-e/200,s=function(t){var n;return n=Math.pow(t,3),n>.008856?n:(t-16/116)/7.787},o=[Math.min(n.XYZ.D65.x,n.XYZ.D65.x*s(r)),Math.min(n.XYZ.D65.y,n.XYZ.D65.y*s(h)),Math.min(n.XYZ.D65.y,n.XYZ.D65.z*s(u))]},n.XYZtoLUV=function(t,i,e){var s,r,o,h,u;return h=4*t/(t+15*i+3*e),u=9*i/(t+15*i+3*e),i/=100,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=4*n.XYZ.D65.x/(n.XYZ.D65.x+15*n.XYZ.D65.y+3*n.XYZ.D65.z),o=9*n.XYZ.D65.y/(n.XYZ.D65.x+15*n.XYZ.D65.y+3*n.XYZ.D65.z),s=116*i-16,[s,13*s*(h-r),13*s*(u-o)]},n.LUVtoXYZ=function(t,i,e){var s,r,o,h,u;return u=(t+16)/116,s=u*u*u,u=s>.008856?s:(u-16/116)/7.787,r=4*n.XYZ.D65.x/(n.XYZ.D65.x+15*n.XYZ.D65.y+3*n.XYZ.D65.z),o=9*n.XYZ.D65.y/(n.XYZ.D65.x+15*n.XYZ.D65.y+3*n.XYZ.D65.z),i=i/(13*t)+r,e=e/(13*t)+o,u=100*u,h=-9*u*i/((i-4)*e-i*e),[h,u,(9*u-15*e*u-e*h)/(3*e)]},n.LABtoLCH=function(t,n,i){var e;return e=Math.atan2(i,n),e=e>0?180*e/Math.PI:360-180*Math.abs(e)/Math.PI,[t,Math.sqrt(n*n+i*i),e]},n.LCHtoLAB=function(t,n,i){var e;return e=Math.PI*i/180,[t,Math.cos(e)*n,Math.sin(e)*n]},n.LUVtoLCH=function(t,n,i){return LABtoLCH(t,n,i)},n.LCHtoLUV=function(t,n,i){return LCHtoLAB(t,n,i)},n}(Vector),this.Color=Color,Circle=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.radius=null!=arguments[3]?arguments[3]:0}return extend(n,t),n.prototype.setRadius=function(t){return this.radius=t,this},n.prototype.intersectPoint=function(t){var n,i;return i=new Vector(Point.get(arguments)),n=i.$subtract(this),n.x*n.x+n.y*n.y<this.radius*this.radius},n.prototype.intersectPath=function(t,n){var i,e,s,r,o,h,u,a,c,p,l,y,f;return null==n&&(n=!0),!t instanceof Pair?!1:(r=t.direction(),u=this.$subtract(t),i=r.dot(r,Const.xy),e=u.dot(r,Const.xy),s=u.dot(u,Const.xy)-this.radius*this.radius,a=e/i,l=s/i,o=a*a-l,0>o?n?[]:!1:n?(h=Math.sqrt(o),y=-a+h,f=-a-h,c=new Point(t.x-r.x*y,t.y-r.y*y),p=new Point(t.x-r.x*f,t.y-r.y*f),0===o?[c]:[c,p]):!0)},n.prototype.intersectLine=function(t,n){var i,e,s,r,o,h;if(null==n&&(n=!0),h=this.intersectPath(t),h&&h.length>0){for(o=[],i=t.bounds(),e=0,s=h.length;s>e;e++)if(r=h[e],Rectangle.contain(r,i,i.p1)){if(!n)return!0;o.push(r)}return n?o:o.length>0}return n?[]:!1},n.prototype.intersectLines=function(t,n){return null==n&&(n=!0),Line.intersectLines(this,t,n)},n.prototype.intersectCircle=function(t,n){var i,e,s,r,o,h,u,a;return null==n&&(n=!0),h=t.$subtract(this),o=h.magnitude(!1),r=Math.sqrt(o),e=this.radius*this.radius,s=t.radius*t.radius,r>this.radius+t.radius?n?[]:!1:r<Math.abs(this.radius-t.radius)?n?[new Vector(this),new Vector(t)]:!0:n?(i=(e-s+o)/(2*r),u=Math.sqrt(e-i*i),a=h.$multiply(i/r).add(this),[new Vector(a.x+u*h.y/r,a.y-u*h.x/r),new Vector(a.x-u*h.y/r,a.y+u*h.x/r)]):!0},n.prototype.hasIntersect=function(t,i){var e,s;return null==i&&(i=!1),t instanceof n?this.intersectCircle(t,i):t instanceof Rectangle||t instanceof PointSet||t instanceof Triangle?this.intersectLines(t.sides(),i):t instanceof Pair?(s=this.intersectLine(t),i?s:s.length>0):t instanceof Point?(e=t.$subtract(this),e.x*e.x+e.y*e.y<this.radius*this.radius):i?[]:!1},n}(Vector),this.Circle=Circle,Particle=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.id=0,this.life={age:0,maxAge:0,active:!0,complete:!1},this.momentum=new Vector,this.velocity=new Vector,this.mass=2,this.friction=0,this.frame_ms=20}return extend(n,t),n.prototype.play=function(t,n){var i,e,s;for(s=0,e=[];n>0;)i=Math.min(n,this.frame_ms),this.integrate(s/1e3,i/1e3),n-=i,s+=i,e.push(this.life.age++);return e},n.prototype.integrate=function(t,n){return this.integrateRK4(t,n)},n.prototype.forces=function(t,n){return{force:new Vector}},n.prototype.impulse=function(t){return this.momentum.add(t),this.velocity=this.momentum.$divide(this.mass)},n.prototype._evaluate=function(t,n,i){var e,s;return null==n&&(n=0),null==i&&(i=!1),s=0!==n&&i?{position:this.$add(i.velocity.$multiply(n)),momentum:this.momentum.$add(i.force.$multiply(n))}:{position:new Vector(this),momentum:new Vector(this.momentum)},s.velocity=s.momentum.$divide(this.mass),e=this.forces(s,t+n),{velocity:s.velocity,force:e.force}},n.prototype.integrateRK4=function(t,n){var i,e,s,r,o;return i=function(t,n,i,e){var s;return s=new Vector((t.x+2*(n.x+i.x)+e.x)/6,(t.y+2*(n.y+i.y)+e.y)/6,(t.z+2*(n.z+i.z)+e.z)/6)},e=this._evaluate(t,0),s=this._evaluate(t,.5*n,e),r=this._evaluate(t,.5*n,s),o=this._evaluate(t,n,r),this.add(i(e.velocity,s.velocity,r.velocity,o.velocity)),this.momentum.add(i(e.force,s.force,r.force,o.force))},n.prototype.integrateEuler=function(t,n){var i;return i=this.forces({position:new Vector(this),momentum:new Vector(this.momentum)},t+n),this.add(this.velocity),this.momentum.add(i.force),this.velocity=this.momentum.$divide(this.mass)},n.prototype.collideLine2d=function(t,n){var i,e,s,r,o,h,u,a,c,p,l,y,f,m,d,g,x,v,_,z;if(null==n&&(n=!0),o=new Vector(this),r=Math.abs(t.getDistanceFromPoint(o)),e=Math.abs(r)<this.radius,n&&(c=this.$add(this.velocity),a=Math.abs(t.getDistanceFromPoint(c)),s=t.intersectLine(new Line(o).connect(c)),s&&(c=s.$add(this.velocity.$normalize().$multiply(-this.radius/2)),a=Math.abs(t.getDistanceFromPoint(c)),e=!0)),e){if(g=t.getPerpendicularFromPoint(o),z=t.$subtract(t.p1),i=!1,!t.withinBounds(g,Const.xy)){if(this.intersectPoint(t)&&(i=!0,
u=this.$subtract(t)),this.intersectPoint(t.p1)&&(i=!0,u=this.$subtract(t.p1)),!i)return!1;z=new Vector(-u.y,u.x)}h=z.dot(this.velocity),f=z.$multiply(h/z.dot(z)),_=f.$subtract(this.velocity),this.velocity=f.$add(_),this.momentum=this.velocity.$multiply(this.mass),n&&!i&&(l=new Line(g).connect(o),y=t.getPerpendicularFromPoint(c),p=new Line(g).connect(y),x=p.direction(),v=(this.radius-r)/(a-r),m=x.$multiply(v).$add(p),d=m.$add(l.direction().$normalize().$multiply(this.radius)),this.set(d.$add(this.velocity.$normalize())))}return e},n.prototype.collideWithinBounds=function(t){return this.x-this.radius<t.x||this.x+this.radius>t.p1.x?(this.x-this.radius<t.x?this.x=t.x+this.radius:this.x+this.radius>t.p1.x&&(this.x=t.p1.x-this.radius),this.velocity.x*=-1,this.momentum=this.velocity.$multiply(this.mass),!0):this.y-this.radius<t.y||this.y+this.radius>t.p1.y?(this.y-this.radius<t.y?this.y=t.y+this.radius:this.y+this.radius>t.p1.y&&(this.y=t.p1.y-this.radius),this.velocity.y*=-1,this.momentum=this.velocity.$multiply(this.mass),!0):!1},n.prototype.collideParticle2d=function(t){return this.hasIntersect(t)?n.collideParticle2d(this,t,!0):!1},n.collideParticle2d=function(t,n,i,e){var s,r,o,h,u,a,c,p,l,y,f,m,d,g,x,v,_;return null==i&&(i=!0),null==e&&(e=!0),y=t.$subtract(n).normalize(),d=new Vector(-y.y,y.x),h=y.dot(t.velocity),u=d.dot(t.velocity),a=y.dot(n.velocity),c=d.dot(n.velocity),s=(h*(t.mass-n.mass)+2*n.mass*a)/(t.mass+n.mass),r=(a*(n.mass-t.mass)+2*t.mass*h)/(t.mass+n.mass),g=y.$multiply(s),x=d.$multiply(u),v=y.$multiply(r),_=d.$multiply(c),f=g.$add(x),m=v.$add(_),e&&(p=t.magnitude(n),p<t.radius+n.radius&&(o=t.$subtract(n).normalize(),l=Math.abs(p-t.radius-n.radius)/1.98,t.add(o.multiply(l)),n.add(o.multiply(-l)))),i&&(t.velocity=f,n.velocity=m,t.momentum=t.velocity.$multiply(t.mass),n.momentum=n.velocity.$multiply(n.mass)),[f,m]},n.force_gravitation=function(t,n,i,e,s){var r,o,h,u;return null==s&&(s=.0067),u=30,r=e.$subtract(t.position),h=r.magnitude()/u,o=0===h?0:n*s*i.mass*e.mass/(h*h),r.normalize().multiply(o),{force:r}},n.RK4=function(t,n,i,e,s){var r,o,h,u,a,c,p,l,y,f,m,d,g;return u=t,l=n,r=i(u,l,0,s),a=t+.5*l*e,y=n+.5*r*e,o=i(a,y,e/2,s),c=t+.5*y*e,f=n+.5*o*e,h=i(c,f,e/2,s),p=t+f*e,m=n+h*e,d=(u+2*(a+c)+p)/6,g=(l+2*(y+f)+m)/6,{c:t+d*e,d:n+g*e}},n}(Circle),this.Particle=Particle,ParticleSystem=function(){function t(){this.count=0,this.particles=[],this.time=0}return t.prototype.add=function(t){return t.id=this.count++,this.particles.push(t),this},t.prototype.remove=function(t){return t&&t.life&&(t.life.complete=!0),this},t.prototype.animate=function(t,n,i){var e,s,r,o,h,u,a,c,p,l;for(this.time++,e=[],p=this.particles,s=o=0,h=p.length;h>o;s=++o)c=p[s],c.life.complete?e.push(s):c.life.active&&c.animate(t,n,i);if(e.length>0){for(l=[],a=0,u=e.length;u>a;a++)r=e[a],l.push(this.particles.splice(r,1));return l}},t}(),this.ParticleSystem=ParticleSystem,Pair=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.p1=new Vector(this.x,this.y,this.z),4===arguments.length?(this.z=0,this.p1.set(arguments[2],arguments[3])):6===arguments.length&&this.p1.set(arguments[3],arguments[4],arguments[5])}return extend(n,t),n.prototype.connect=function(){return this.p1=new Vector(Point.get(arguments)),this},n.prototype.relative=function(){return this.p1.add(this),this},n.prototype.$relative=function(){return this.$add(this.p1)},n.prototype.pointsAdd=function(t){var n;return n=this._getArgs(arguments),this.add(n),this.p1.add(n),this},n.prototype.$pointsAdd=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$add(n)).connect(this.p1.$add(n))},n.prototype.pointsSubtract=function(t){var n;return n=this._getArgs(arguments),this.subtract(n),this.p1.subtract(n),this},n.prototype.$pointsSubtract=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$subtract(n)).connect(this.p1.$subtract(n))},n.prototype.pointsMultiply=function(t){var n;return n=this._getArgs(arguments),this.multiply(n),this.p1.multiply(n),this},n.prototype.$pointsMultiply=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$multiply(n)).connect(this.p1.$multiply(n))},n.prototype.pointsDivide=function(t){var n;return n=this._getArgs(arguments),this.divide(n),this.p1.divide(n),this},n.prototype.$pointsDivide=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$divide(n)).connect(this.p1.$divide(n))},n.prototype.bounds=function(){return new n(this.min(this.p1)).connect(this.max(this.p1))},n.prototype.withinBounds=function(t,n){var i,e;return n?(i=this.get2D(n),e=this.p1.get2D(n),i.x===e.x?t.y>=Math.min(i.y,e.y)&&t.y<=Math.max(i.y,e.y):i.y===e.y?t.x>=Math.min(i.x,e.x)&&t.x<=Math.max(i.x,e.x):t.x>=Math.min(i.x,e.x)&&t.y>=Math.min(i.y,e.y)&&t.x<=Math.max(i.x,e.x)&&t.y<=Math.max(i.y,e.y)):t.x>=Math.min(this.x,this.p1.x)&&t.y>=Math.min(this.y,this.p1.y)&&t.z>=Math.min(this.z,this.p1.z)&&t.x<=Math.max(this.x,this.p1.x)&&t.y<=Math.max(this.y,this.p1.y)&&t.z<=Math.max(this.z,this.p1.z)},n.prototype.interpolate=function(t,n){var i;return null==n&&(n=!1),i=n?this.$relative():this.p1,new Vector((1-t)*this.x+t*i.x,(1-t)*this.y+t*i.y,(1-t)*this.z+t*i.z)},n.prototype.midpoint=function(){return this.interpolate(.5)},n.prototype.direction=function(t){return t?this.$subtract(this.p1):this.p1.$subtract(this)},n.prototype.size=function(){return arguments.length>0?(this.p1=this.$add(Point.get(arguments)),this):this.p1.$subtract(this).abs()},n.prototype.length=function(t){var n,i,e,s;return null==t&&(t=!0),s=this.z-this.p1.z,e=this.y-this.p1.y,i=this.x-this.p1.x,n=i*i+e*e+s*s,t?Math.sqrt(n):n},n.prototype.collinear=function(t){return(this.p1.x-this.x)*(t.y-this.y)-(t.x-this.x)*(this.p1.y-this.y)},n.prototype.resetBounds=function(){var t;return t=this.min(this.p1),this.p1.set(this.max(this.p1)),this.set(t),this},n.prototype.equal=function(t){return null==t&&(t=!1),arguments[0]instanceof n?n.__super__.equal.call(this,arguments[0])&&this.p1.equal(arguments[0].p1):n.__super__.equal.apply(this,arguments)},n.prototype.clone=function(){var t;return t=new n(this),t.connect(this.p1.clone()),t},n.prototype.floor=function(){return n.__super__.floor.apply(this,arguments),this.p1.floor()},n.prototype.toString=function(){return"Pair of vectors from ("+this.x+", "+this.y+", "+this.z+") to ("+this.p1.x+", "+this.p1.y+", "+this.p1.z+")"},n.prototype.toArray=function(){return[this,this.p1]},n}(Vector),this.Pair=Pair,Line=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return extend(n,t),n.slope=function(t,n,i){var e,s;return null==i&&(i=Const.xy),e=t.get2D(i),s=n.get2D(i),s.x-e.x===0?!1:(s.y-e.y)/(s.x-e.x)},n.intercept=function(t,n,i){var e,s,r,o;return null==i&&(i=Const.xy),r=t.get2D(i),o=n.get2D(i),o.x-r.x===0?!1:(s=(o.y-r.y)/(o.x-r.x),e=r.y-s*r.x,{slope:s,yi:e,xi:0===s?!1:-e/s})},n.isPerpendicularLine=function(t,i,e){var s,r;return null==e&&(e=Const.xy),s=n.slope(t,t.p1,e),r=n.slope(i,i.p1,e),s===!1?0===r:r===!1?0===s:s*r===-1},n.prototype.slope=function(t){return null==t&&(t=Const.xy),n.slope(this,this.p1,t)},n.prototype.intercept=function(t){return null==t&&(t=Const.xy),n.intercept(this,this.p1,t)},n.prototype.getPerpendicularLine=function(t,i,e,s){var r,o,h;return null==i&&(i=10),null==e&&(e=!1),null==s&&(s=Const.xy),o=this.direction().normalize().perpendicular(s),h=e?o[1]:o[0],r=new n(this.interpolate(t)),r.connect(h.multiply(i).add(r)),r},n.prototype.getDistanceFromPoint=function(t){var n,i;return i=this.$subtract(this.p1),n=new Vector(-i.y,i.x).normalize(),this.$subtract(t).dot(n)},n.prototype.getPerpendicularFromPoint=function(t,n){var i;return null==n&&(n=!0),i=this.p1.$subtract(this).projection(t.$subtract(this)),n?i.add(this):i},n.prototype.intersectPath=function(t,n){var i,e,s,r,o,h,u;return null==n&&(n=Const.xy),i=this.intercept(n),e=t.intercept(n),r=this.get2D(n),s=t.get2D(n),i===!1?e===!1?!1:(u=-e.slope*(s.x-r.x)+s.y,n===Const.xy?new Vector(r.x,u):new Vector(r.x,u).get2D(n,!0)):e===!1?(u=-i.slope*(r.x-s.x)+r.y,new Vector(s.x,u)):e.slope!==i.slope?(o=(i.slope*r.x-e.slope*s.x+s.y-r.y)/(i.slope-e.slope),h=i.slope*(o-r.x)+r.y,n===Const.xy?new Vector(o,h):new Vector(o,h).get2D(n,!0)):i.yi===e.yi?null:!1},n.prototype.intersectLine=function(t,n){var i;return null==n&&(n=Const.xy),i=this.intersectPath(t,n),i&&this.withinBounds(i,n)&&t.withinBounds(i,n)?i:null===i?null:!1},n.intersectLines=function(t,n,i){var e,s,r,o,h,u,a;if(null==i&&(i=!0),!t.intersectLine)throw"No intersectLine function found in "+t.toString();a=[];for(e in n)if(h=n[e],s=t.intersectLine(h,i)){if(!i)return!0;if(s.length>0)for(r=0,o=s.length;o>r;r++)u=s[r],a.push(u)}return i?a:!1},n.prototype.intersectGridLine=function(t,n,i){var e,s,r,o;if(null==n&&(n=!1),null==i&&(i=Const.xy),e=this.get2D(i),s=this.p1.get2D(i),r=t.get2D(i),o=t.p1.get2D(i),s.x-e.x===0){if(o.y-r.y===0&&Util.within(e.x,r.x,o.x)&&(n||Util.within(r.y,e.y,s.y)))return new Vector(e.x,r.y)}else{if(s.y-e.y!==0)return!1;if(o.x-r.x===0&&Util.within(e.y,r.y,o.y)&&(n||Util.within(r.x,e.x,s.x)))return new Vector(r.x,e.y)}},n.prototype.subpoints=function(t){var n,i,e,s;for(e=[],s=n=0,i=t;i>=0?i>=n:n>=i;s=i>=0?++n:--n)e.push(this.interpolate(s/t));return e},n.prototype.clone=function(t){return new n(this).connect(this.p1)},n}(Pair),this.Line=Line,Rectangle=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.center=new Vector}return extend(n,t),n.contain=function(t,n,i){return t.x>=n.x&&t.x<=i.x&&t.y>=n.y&&t.y<=i.y&&t.z>=n.z&&t.z<=i.z},n.prototype.toString=function(){var t;return t=this.size(),"Rectangle x1 "+this.x+", y1 "+this.y+", z1 "+this.z+", x2 "+this.p1.x+", y2 "+this.p1.y+", z2 "+this.p1.z+", width "+t.x+", height "+t.y},n.prototype.toPointSet=function(){var t;return t=this.corners(),new PointSet(this).connect([t.topRight,t.bottomRight,t.bottomLeft,t.topLeft])},n.prototype.connect=function(t){return this.p1=new Vector(Point.get(arguments)),this.resetBounds(),this.center=this.midpoint(),this},n.prototype.setCenter=function(t){var n;return n=this.size().$divide(2),this.center.set(Point.get(arguments)),this.set(this.center.$subtract(n)),this.p1.set(this.center.$add(n)),this},n.prototype.resizeBy=function(t){var n;return n=new Vector(Point.get(arguments)),this.p1.add(n),this.center=this.midpoint(),this},n.prototype.resizeCenterBy=function(){var t;return t=new Vector(Point.get(arguments)).divide(2),this.subtract(t),this.p1.add(t),this},n.prototype.resizeTo=function(){return this.p1=new Vector(Point.get(arguments)),this.relative(),this.center=this.midpoint(),this},n.prototype.resizeCenterTo=function(){var t;return t=new Vector(Point.get(arguments)).divide(2),this.set(this.center.$subtract(t)),this.p1.set(this.center.$add(t)),this},n.prototype.enclose=function(t){return this.set(this.min(t)),this.p1.set(this.p1.max(t.p1)),this.center=this.midpoint(),this},n.prototype.$enclose=function(t){return this.clone().enclose(t)},n.prototype.isEnclosed=function(t){var n,i;return n=this.$subtract(t).multiply(this.p1.$subtract(t.p1)),i=this.size().subtract(t.size()),n.x<=0&&n.y<=0&&n.z<=0&&i.x*i.y>=0},n.prototype.isLarger=function(t){var n,i;return n=this.size(),i=t.size(),n.x*n.y>i.x*i.y},n.prototype.intersectPoint=function(){var t;return t=Point.get(arguments),t.x>=this.x&&t.x<=this.p1.x&&t.y>=this.y&&t.y<=this.p1.y&&t.z>=this.z&&t.z<=this.p1.z},n.prototype.intersectPath=function(t,n){var i,e,s,r,o,h;for(null==n&&(n=!0),h=this.sides(),r=[],i=0,e=h.length;e>i;i++)if(o=h[i],s=t.intersectPath(o)){if(!n)return!0;r.push(s)}return n?r:!1},n.prototype.intersectLine=function(t,n){var i,e,s,r,o,h,u,a,c;if(null==n&&(n=!0),i=this.intersectPoint(t),e=this.intersectPoint(t.p1),i&&e&&n)return[];if(!i&&!e&&(r=t.bounds(),!this.intersectRectangle(r,!1)))return n?[]:!1;for(c=this.sides(),u=[],s=0,o=c.length;o>s;s++)if(a=c[s],h=t.intersectLine(a)){if(!n)return!0;u.push(h)}return n?u:!1},n.prototype.intersectLines=function(t,n){return null==n&&(n=!0),Line.intersectLines(this,t,n)},n.prototype.intersectRectangle=function(t,n){var i,e,s,r,o,h,u,a,c,p,l,y,f,m;if(null==n&&(n=!0),y=this.p1.x>=t.x&&this.x<=t.p1.x,f=this.p1.y>=t.y&&this.y<=t.p1.y,m=this.p1.z>=t.z&&this.z<=t.p1.z,i=y&&f&&m,!n)return i;if(this.isEnclosed(t))return n?[]:!0;if(!i)return[];for(p=this.sides(),l=t.sides(),u=[],e=0,s=p.length;s>e;e++)for(a=p[e],o=0,r=l.length;r>o;o++)c=l[o],h=a.intersectGridLine(c),h&&u.push(h);return u},n.prototype.hasIntersect=function(t,i){return null==i&&(i=!1),t instanceof Circle?t.intersectLines(this.sides(),i):t instanceof n?this.intersectRectangle(t,i):t instanceof PointSet||t instanceof Triangle?this.intersectLines(t.sides(),i):t instanceof Pair?this.intersectLine(t,i):t instanceof Point?n.contain(t,this,this.p1):i?[]:!1},n.prototype.corners=function(){return{topLeft:new Vector(Math.min(this.x,this.p1.x),Math.min(this.y,this.p1.y),Math.max(this.z,this.p1.z)),topRight:new Vector(Math.max(this.x,this.p1.x),Math.min(this.y,this.p1.y),Math.min(this.z,this.p1.z)),bottomLeft:new Vector(Math.min(this.x,this.p1.x),Math.max(this.y,this.p1.y),Math.max(this.z,this.p1.z)),bottomRight:new Vector(Math.max(this.x,this.p1.x),Math.max(this.y,this.p1.y),Math.min(this.z,this.p1.z))}},n.prototype.sides=function(){var t;return t=this.corners(),[new Line(t.topLeft).connect(t.topRight),new Line(t.topRight).connect(t.bottomRight),new Line(t.bottomRight).connect(t.bottomLeft),new Line(t.bottomLeft).connect(t.topLeft)]},n.prototype.quadrants=function(){var t;return t=this.corners(),{topLeft:new this.__proto__.constructor(t.topLeft).connect(this.center),topRight:new this.__proto__.constructor(t.topRight).connect(this.center),bottomLeft:new this.__proto__.constructor(t.bottomLeft).connect(this.center),bottomRight:new this.__proto__.constructor(t.bottomRight).connect(this.center)}},n.prototype.clone=function(){var t;return t=new n(this).connect(this.p1),t.connect(this.p1.clone()),t},n}(Pair),this.Rectangle=Rectangle,Grid=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.cell={type:"fix-fix",size:new Vector},this.rows=0,this.columns=0,this.layout=[]}return extend(n,t),n.prototype.toString=function(){var t;return t=this.size(),"Grid width "+t.x+", height "+t.y+", columns "+this.columns+", rows "+this.rows+", "+("cell ("+this.cell.size.x+", "+this.cell.size.y+"), type "+this.cell.type)},n.prototype.create=function(t,n,i,e){var s;return null==i&&(i="fix"),null==e&&(e="fix"),s=this.size(),this.cell.type=i+"-"+e,this.rows=n,this.columns=t,"stretch"===i?(this.cell.size.x=s.x/t,this.columns=t):"flex"===i?(this.columns=Math.round(s.x/t),this.cell.size.x=s.x/this.columns):(this.cell.size.x=t,this.columns=Math.ceil(s.x/this.cell.size.x)),"stretch"===e?(this.cell.size.y=s.y/n,this.rows=n):"flex"===e?(this.rows=Math.round(s.y/n),this.cell.size.y=s.y/this.rows):(this.cell.size.y=n,this.rows=Math.ceil(s.y/this.cell.size.y)),this},n.prototype.generate=function(t){var n,i,e,s,r,o,h,u;for(n=e=0,h=this.columns;h>=0?h>e:e>h;n=h>=0?++e:--e)for(o=s=0,u=this.rows;u>=0?u>s:s>u;o=u>=0?++s:--s)i=this.cell.size.clone(),r=this.$add(i.$multiply(n,o)),t(this,i,r,o,n,this.cell.type);return this},n.prototype.resetLayout=function(t){var n,i,e,s,r,o;for(this.layout=[],s=i=0,r=this.rows;r>=0?r>i:i>r;s=r>=0?++i:--i)for(this.layout[s]=[],n=e=0,o=this.columns;o>=0?o>e:e>o;n=o>=0?++e:--e)this.layout[s][n]=0,t&&t(this,s,n);return this},n.prototype.occupy=function(t,n,i,e){var s,r,o,h,u,a;for(s=r=0,u=i;u>=0?u>r:r>u;s=u>=0?++r:--r)for(h=o=0,a=e;a>=0?a>o:o>a;h=a>=0?++o:--o)this.layout[Math.min(this.layout.length-1,n+h)][t+s]=1;return this},n.prototype.fit=function(t,n){var i,e,s,r,o,h,u,a,c,p,l;for(r=Math.min(t,this.columns),h=a=0,p=this.rows;p>=0?p>a:a>p;h=p>=0?++a:--a)for(s=r,u=0,o=c=0,l=this.columns;l>=0?l>c:c>l;o=l>=0?++c:--c)if(e=this.layout[h][o],null!=e&&e>0)u++,s=r;else if(s--,0>=s)return this.occupy(u,h,r,n),i=new Rectangle(this.$add(this.cell.size.$multiply(u,h))),i.resizeTo(this.cell.size.$multiply(r,n)),{row:h,column:u,columnSize:r,rowSize:n,bound:i};return!1},n}(Rectangle),this.Grid=Grid,PointSet=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.points=[]}return extend(n,t),n.prototype.toString=function(){var t,n,i,e,s;for(s="PointSet [ ",e=this.points,t=0,n=e.length;n>t;t++)i=e[t],s+=i.x+","+i.y+","+i.z+", ";return s+" ]"},n.prototype.toArray=function(){return this.points.slice()},n.prototype.connect=function(t){var n,i,e,s;if(arguments.length>0)if(Array.isArray(arguments[0])&&arguments[0].length>0&&"object"==typeof arguments[0][0])for(s=arguments[0],n=0,i=s.length;i>n;n++)e=s[n],this.points.push(new Vector(e));else this.points.push(new Vector(Point.get(arguments)));return this},n.prototype.connectFromAnchor=function(t){var n,i,e,s;if(arguments.length>0)if(Array.isArray(arguments[0])&&arguments[0].length>0)for(s=arguments[0],n=0,i=s.length;i>n;n++)e=s[n],this.points.push(this.$add(e));else this.points.push(this.$add(Point.get(arguments)));return this},n.prototype.disconnect=function(t){return null==t&&(t=-1),this.points=0>t?this.points.slice(0,this.points.length+t):this.points.slice(t+1),this},n.prototype.pointsAdd=function(t){var n,i,e,s,r;for(n=this._getArgs(arguments),r=this.points,i=0,e=r.length;e>i;i++)s=r[i],s.add(n);return this},n.prototype.$pointsAdd=function(t){var n,i;return n=this._getArgs(arguments),function(){var t,e,s,r;for(s=this.points,r=[],t=0,e=s.length;e>t;t++)i=s[t],r.push(i.$add(n));return r}.call(this)},n.prototype.pointsSubtract=function(t){var n,i,e,s,r;for(n=this._getArgs(arguments),r=this.points,i=0,e=r.length;e>i;i++)s=r[i],s.subtract(n);return this},n.prototype.$pointsSubtract=function(t){var n,i;return n=this._getArgs(arguments),function(){var t,e,s,r;for(s=this.points,r=[],t=0,e=s.length;e>t;t++)i=s[t],r.push(i.$subtract(n));return r}.call(this)},n.prototype.pointsMultiply=function(t){var n,i,e,s,r;for(n=this._getArgs(arguments),r=this.points,i=0,e=r.length;e>i;i++)s=r[i],s.multiply(n);return this},n.prototype.$pointsMultiply=function(t){var n,i;return n=this._getArgs(arguments),function(){var t,e,s,r;for(s=this.points,r=[],t=0,e=s.length;e>t;t++)i=s[t],r.push(i.$multiply(n));return r}.call(this)},n.prototype.pointsDivide=function(t){var n,i,e,s,r;for(n=this._getArgs(arguments),r=this.points,i=0,e=r.length;e>i;i++)s=r[i],s.divide(n);return this},n.prototype.$pointsDivide=function(t){var n,i;return n=this._getArgs(arguments),function(){var t,e,s,r;for(s=this.points,r=[],t=0,e=s.length;e>t;t++)i=s[t],r.push(i.$divide(n));return r}.call(this)},n.prototype.sides=function(t){var n,i,e,s,r,o;for(null==t&&(t=!0),i=null,o=[],r=this.points,n=0,e=r.length;e>n;n++)s=r[n],i&&o.push(new Line(i).connect(s)),i=s;return t&&o.push(new Line(i).connect(this.points[0])),o},n.prototype.angles=function(t){var n,i,e,s,r,o;for(null==t&&(t=Const.xy),n=[],i=e=1,s=this.points.length-1;s>e;i=e+=1)r=this.points[i-1].$subtract(this.points[i]),o=this.points[i+1].$subtract(this.points[i]),n.push({p0:this.points[i-1],p1:this.points[i],p2:this.points[i+1],angle:r.angleBetween(o)});return n},n.prototype.bounds=function(){return Util.boundingBox(this.points)},n.prototype.centroid=function(){return Util.centroid(this.points)},n.prototype.convexHull=function(t){var n,i,e,s,r;if(null==t&&(t=!0),this.points.length<3)return[];for(t?(r=this.points.slice(),r.sort(function(t,n){return t.x-n.x})):r=this.points,e=function(t,n,i){return(n.x-t.x)*(i.y-t.y)-(i.x-t.x)*(n.y-t.y)>0},n=[],e(r[0],r[1],r[2])?(n.push(r[0]),n.push(r[1])):(n.push(r[1]),n.push(r[0])),n.unshift(r[2]),n.push(r[2]),i=3;i<r.length;)if(s=r[i],e(s,n[0],n[1])&&e(n[n.length-2],n[n.length-1],s))i++;else{for(;!e(n[n.length-2],n[n.length-1],s);)n.pop();for(n.push(s);!e(n[0],n[1],s);)n.shift();n.unshift(s),i++}return n},n.prototype.clone=function(){return new n(this).connect(Util.clonePoints(this.points))},n}(Vector),this.PointSet=PointSet,Curve=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.is3D=!1}return extend(n,t),n.prototype._getSteps=function(t){var n,i,e,s,r;for(r=[],e=n=0,i=t;i>=n;e=n+=1)s=e/t,r.push([s,s*s,s*s*s]);return r},n.prototype.controlPoints=function(t,n){var i,e,s,r,o;return null==t&&(t=0),null==n&&(n=!1),i=function(t){return function(n){var i;return i=n<t.points.length-1?n:t.points.length-1}}(this),e=this.points[t],null==e.x?!1:(t=n?t:t+1,s=this.points[i(t++)],r=this.points[i(t++)],o=this.points[i(t++)],{p0:e,p1:s,p2:r,p3:o})},n.prototype.catmullRom=function(t){var n,i,e,s,r,o,h,u,a;if(null==t&&(t=10),this.points.length<2)return[];for(o=[],a=this._getSteps(t),n=this.controlPoints(0,!0),i=e=0,h=t;h>=e;i=e+=1)o.push(this.catmullRomPoint(a[i],n));for(s=0;s<this.points.length-2;)if(n=this.controlPoints(s)){for(i=r=0,u=t;u>=r;i=r+=1)o.push(this.catmullRomPoint(a[i],n));s++}return o},n.prototype.catmullRomPoint=function(t,n){var i,e,s,r,o,h,u,a,c,p;return o=t[0],h=t[1],u=t[2],i=-.5*u+h-.5*o,e=1.5*u-2.5*h+1,s=-1.5*u+2*h+.5*o,r=.5*u-.5*h,a=i*n.p0.x+e*n.p1.x+s*n.p2.x+r*n.p3.x,c=i*n.p0.y+e*n.p1.y+s*n.p2.y+r*n.p3.y,p=this.is3D?i*n.p0.z+e*n.p1.z+s*n.p2.z+r*n.p3.z:0,new Point(a,c,p)},n.prototype.cardinal=function(t,n){var i,e,s,r,o,h,u,a,c;if(null==t&&(t=10),null==n&&(n=.5),this.points.length<2)return[];for(h=[],c=this._getSteps(t),i=this.controlPoints(0,!0),e=s=0,u=t;u>=s;e=s+=1)h.push(this.cardinalPoint(c[e],i,n));for(r=0;r<this.points.length-2;)if(i=this.controlPoints(r)){for(e=o=0,a=t;a>=o;e=o+=1)h.push(this.cardinalPoint(c[e],i,n));r++}return h},n.prototype.cardinalPoint=function(t,n,i){var e,s,r,o,h,u,a,c,p,l,y,f;return null==i&&(i=.5),a=t[0],c=t[1],p=t[2],e=i*(-1*p+2*c-a),s=i*(-1*p+c),r=2*p-3*c+1,o=i*(p-2*c+a),h=-2*p+3*c,u=i*(p-c),l=n.p0.x*e+n.p1.x*s+r*n.p1.x+n.p2.x*o+h*n.p2.x+n.p3.x*u,y=n.p0.y*e+n.p1.y*s+r*n.p1.y+n.p2.y*o+h*n.p2.y+n.p3.y*u,f=this.is3D?n.p0.z*e+n.p1.z*s+r*n.p1.z+n.p2.z*o+h*n.p2.z+n.p3.z*u:0,new Point(l,y,f)},n.prototype.bezier=function(t){var n,i,e,s,r,o,h;if(null==t&&(t=10),this.points.length<4)return[];for(r=[],h=this._getSteps(t),s=0;s<=this.points.length-3;)if(n=this.controlPoints(s)){for(i=e=0,o=t;o>=e;i=e+=1)r.push(this.bezierPoint(h[i],n));s+=3}return r},n.prototype.bezierPoint=function(t,n){var i,e,s,r,o,h,u,a,c,p;return o=t[0],h=t[1],u=t[2],i=-1*u+3*h-3*o+1,e=3*u-6*h+3*o,s=-3*u+3*h,r=u,a=i*n.p0.x+e*n.p1.x+s*n.p2.x+r*n.p3.x,c=i*n.p0.y+e*n.p1.y+s*n.p2.y+r*n.p3.y,p=this.is3D?i*n.p0.z+e*n.p1.z+s*n.p2.z+r*n.p3.z:0,new Point(a,c,p)},n.prototype.bspline=function(t,n){var i,e,s,r,o,h,u,a,c;if(null==t&&(t=10),null==n&&(n=!1),this.points.length<2)return[];for(h=[],c=this._getSteps(t),r=0;r<this.points.length-2;)if(i=this.controlPoints(r)){if(n)for(e=o=0,a=t;a>=o;e=o+=1)h.push(this.bsplineTensionPoint(c[e],i,n));else for(e=s=0,u=t;u>=s;e=s+=1)h.push(this.bsplinePoint(c[e],i));r++}return h},n.prototype.bsplinePoint=function(t,n){var i,e,s,r,o,h,u,a,c,p;return o=t[0],h=t[1],u=t[2],i=-.16666666666*u+.5*h-.5*o+.16666666666,e=.5*u-h+.66666666666,s=-.5*u+.5*h+.5*o+.16666666666,r=.16666666666*u,a=i*n.p0.x+e*n.p1.x+s*n.p2.x+r*n.p3.x,c=i*n.p0.y+e*n.p1.y+s*n.p2.y+r*n.p3.y,p=this.is3D?i*n.p0.z+e*n.p1.z+s*n.p2.z+r*n.p3.z:0,new Point(a,c,p)},n.prototype.bsplineTensionPoint=function(t,n,i){var e,s,r,o,h,u,a,c,p,l,y,f;return null==i&&(i=1),a=t[0],c=t[1],p=t[2],e=i*(-.16666666666*p+.5*c-.5*a+.16666666666),s=i*(-1.5*p+2*c-.33333333333),r=2*p-3*c+1,o=i*(1.5*p-2.5*c+.5*a+.16666666666),h=-2*p+3*c,u=.16666666666*i*p,l=e*n.p0.x+s*n.p1.x+r*n.p1.x+o*n.p2.x+h*n.p2.x+u*n.p3.x,y=e*n.p0.y+s*n.p1.y+r*n.p1.y+o*n.p2.y+h*n.p2.y+u*n.p3.y,f=this.is3D?e*n.p0.z+s*n.p1.z+r*n.p1.y+o*n.p2.z+h*n.p2.z+u*n.p3.z:0,new Point(l,y,f)},n}(PointSet),this.Curve=Curve,Triangle=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.p1=new Vector(this.x-1,this.y-1,this.z),this.p2=new Vector(this.x+1,this.y+1,this.z)}return extend(n,t),n.prototype.connect=function(t){return arguments.length>0&&("object"==typeof arguments[0]&&2===arguments.length?(this.p1.set(arguments[0]),this.p2.set(arguments[1])):arguments.length<6?(this.p1.set([arguments[0],arguments[1]]),this.p2.set([arguments[2],arguments[3]])):(this.p1.set([arguments[0],arguments[1],arguments[2]]),this.p2.set([arguments[3],arguments[4],arguments[5]]))),this},n.prototype.toArray=function(){return[this,this.p1,this.p2]},n.prototype.toString=function(){return"Triangle ("+this.x+", "+this.y+", "+this.z+"), ("+this.p1.x+", "+this.p1.y+", "+this.p1.z+"), ("+this.p2.x+", "+this.p2.y+", "+this.p2.z+")"},n.prototype.toPointSet=function(){var t;return t=new Vector(this),new PointSet(t).connect([t,this.p1,this.p2])},n.prototype.pointsAdd=function(t){var n;return n=this._getArgs(arguments),this.add(n),this.p1.add(n),this.p2.add(n),this},n.prototype.$pointsAdd=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$add(n)).connect(this.p1.$add(n),this.p2.$add(n))},n.prototype.pointsSubtract=function(t){var n;return n=this._getArgs(arguments),this.subtract(n),this.p1.subtract(n),this.p2.subtract(n),this},n.prototype.$pointsSubtract=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$subtract(n)).connect(this.p1.$subtract(n),this.p2.$subtract(n))},n.prototype.pointsMultiply=function(t){var n;return n=this._getArgs(arguments),this.multiply(n),this.p1.multiply(n),this.p2.multiply(n),this},n.prototype.$pointsMultiply=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$multiply(n)).connect(this.p1.$multiply(n),this.p2.$multiply(n))},n.prototype.pointsDivide=function(t){var n;return n=this._getArgs(arguments),this.divide(n),this.p1.divide(n),this.p2.divide(n),this},n.prototype.$pointsDivide=function(t){var n;return n=this._getArgs(arguments),new this.__proto__.constructor(this.$divide(n)).connect(this.p1.$divide(n),this.p2.$divide(n))},n.prototype.sides=function(){return[new Line(this).connect(this.p1),new Line(this.p1).connect(this.p2),new Line(this.p2).connect(this)]},n.prototype.angles=function(t){var n;return null==t&&(t=Const.xy),n=[this.p2.$subtract(this).angleBetween(this.p1.$subtract(this),t),this.$subtract(this.p1).angleBetween(this.p2.$subtract(this.p1),t)],n.push(Math.PI-n[0]-n[1]),n},n.prototype.medial=function(){var t,i,e;return e=this.sides(),t=function(){var t,n,s;for(s=[],t=0,n=e.length;n>t;t++)i=e[t],s.push(i.midpoint());return s}(),new n(t[0]).connect(t[1],t[2])},n.prototype.perimeter=function(){var t,n;return n=this.sides(),t=[n[0].length(),n[1].length(),n[2].length()],{sides:n,value:t[0]+t[1]+t[2],lengths:t}},n.prototype.area=function(){var t,n;return n=this.perimeter(),t=n.value/2,{value:Math.sqrt(t*(t-n.lengths[0])*(t-n.lengths[1])*(t-n.lengths[2])),perimeter:n}},n.prototype.oppositeSide=function(t){return"p1"===t?new Line(this).connect(this.p2):"p2"===t?new Line(this).connect(this.p1):new Line(this.p1).connect(this.p2)},n.prototype.adjacentSides=function(t){return"p1"===t?[new Line(this.p1).connect(this),new Line(this.p1).connect(this.p2)]:"p2"===t?[new Line(this.p2).connect(this),new Line(this.p2).connect(this.p1)]:[new Line(this).connect(this.p1),new Line(this).connect(this.p2)]},n.prototype.bisector=function(t,n,i){var e,s,r;return null==n&&(n=!1),null==i&&(i=100),e=this.adjacentSides(t),r=new Vector(e[0]),e[0].moveTo(0,0),e[1].moveTo(0,0),s=e[0].p1.bisect(e[1].p1),n?new Line(r).connect(s.multiply(i).add(r)):s},n.prototype.altitude=function(t){return"p1"===t||"p2"===t?new Line(this[t]).connect(this.oppositeSide(t).getPerpendicularFromPoint(this[t])):new Line(this).connect(this.oppositeSide().getPerpendicularFromPoint(this))},n.prototype.centroid=function(){var t,n,i;return t=this.$divide(3),n=this.p1.$divide(3),i=this.p2.$divide(3),new Vector(t.x+n.x+i.x,t.y+n.y+i.y,t.z+n.z+i.z)},n.prototype.orthocenter=function(){var t,n;return t=this.altitude(),n=this.altitude("p1"),t.intersectPath(n,Const.xyz)},n.prototype.incenter=function(){var t,n;return t=this.bisector("p0",!0),n=this.bisector("p1",!0),t.intersectPath(n,Const.xyz)},n.prototype.incircle=function(){var t,n,i;return n=this.incenter(),t=this.area(),i=2*t.value/t.perimeter.value,new Circle(n).setRadius(i)},n.prototype.circumcenter=function(){var t,n;return t=this.medial(),n=[new Line(t).connect(this.$subtract(t).perpendicular()[0].$add(t)),new Line(t.p1).connect(this.p1.$subtract(t.p1).perpendicular()[0].$add(t.p1)),new Line(t.p2).connect(this.p2.$subtract(t.p2).perpendicular()[0].$add(t.p2))],{center:n[0].intersectPath(n[1],Const.xyz),bisectors:n}},n.prototype.circumcircle=function(){var t,n;return t=this.circumcenter(),n=this.magnitude(t.center),new Circle(t.center).setRadius(n)},n.prototype.intersectPoint=function(t){var n,i,e;return e=this.sides(),n=function(){var n,s,r;for(r=[],n=0,s=e.length;s>n;n++)i=e[n],r.push(i.collinear(t)>0);return r}(),n[0]===n[1]&&n[1]===n[2]},n.prototype.intersectPath=function(t,n,i){var e,s,r,o,h,u;for(null==n&&(n=!0),null==i&&(i=Const.xy),u=this.sides(),o=[],e=0,s=u.length;s>e;e++)if(h=u[e],r=h.intersectPath(t),r&&h.withinBounds(r,i)){if(!n)return!0;o.push(r)}return n?o:!1},n.prototype.intersectLine=function(t,n,i){var e,s,r,o,h;for(null==n&&(n=!0),null==i&&(i=Const.xy),e=this.intersectPath(t,!0,i),h=[],s=0,r=e.length;r>s;s++)if(o=e[s],t.withinBounds(o)){if(!n)return!0;h.push(o)}return n?h:!1},n.prototype.intersectLines=function(t,n){return null==n&&(n=!0),Line.intersectLines(this,t,n)},n.prototype.intersectPath3D=function(t,n){var i,e,s,r,o,h,u,a,c,p,l;return s=this.p1.$subtract(this),r=this.p2.$subtract(this),e=t.direction().normalize(),h=e.cross(r),i=s.dot(h),i>-Const.epsilon&&i<Const.epsilon?!1:(o=1/i,c=t.$subtract(this),p=c.dot(h)*o,0>p||p>1?!1:(u=c.cross(s),l=e.dot(u)*o,0>l||l>1?!1:(a=r.dot(u)*o,a>Const.epsilon?n?[p,l,a]:!0:!1)))},n.prototype.intersectRectangle=function(t,n){return null==n&&(n=!0),t.intersectLines(this.sides(),n)},n.prototype.intersectCircle=function(t,n){return null==n&&(n=!0),t.intersectLines(this.sides(),n)},n.prototype.intersectTriangle=function(t,n){return null==n&&(n=!0),t.intersectLines(this.sides(),n)},n.prototype.clone=function(){return new n(this).connect(this.p1,this.p2)},n}(Vector),this.Triangle=Triangle;